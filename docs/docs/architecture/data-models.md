# Data Models

Complete reference for all data models in Agents MCP Server.

## Core Models

### Tool

Represents an MCP tool that can be executed.

```typescript
interface ITool {
  name: string;                    // Unique tool name
  description: string;              // Tool description
  inputSchema: Record<string, any>; // JSON schema for inputs
  source: 'remote' | 'local';       // Source of the tool
  operationType?: 'query' | 'mutation';
  entityType?: 'facility' | 'shipment' | 'contaminant' | 'contract' | 'inspection' | 'other';
  createdAt: Date;
  updatedAt: Date;
}
```

**Use Cases**: Tool management, execution, discovery

### AgentConfig

AI model configuration for agent execution.

```typescript
interface IAgentConfig {
  availableModelId: string;  // Reference to AvailableModel
  apiKey: string;            // API key for the model
  maxTokenCount: number;     // Maximum tokens
  isEnabled: boolean;        // Whether config is active
  createdAt: Date;
  updatedAt: Date;
}
```

**Use Cases**: Configure AI models for Thought, Planner, Executor agents

### AvailableModel

Available AI models that can be used.

```typescript
interface IAvailableModel {
  provider: string;    // e.g., 'openai', 'anthropic'
  modelName: string;   // e.g., 'GPT-4', 'Claude 3'
  modelId: string;      // API model identifier
  createdAt: Date;
  updatedAt: Date;
}
```

**Use Cases**: Model management, agent configuration

### Thought

Structured reasoning generated by the Thought Agent.

```typescript
interface IThought {
  userQuery: string;
  agentConfigId: string;
  thoughts: Array<{
    id: string;
    timestamp: string;
    reasoning: string;
    approaches: string[];
    constraints: string[];
    assumptions: string[];
    uncertainties: string[];
    confidence: number;  // 0-1
  }>;
  primaryApproach: string;
  keyInsights: string[];
  recommendedTools: string[];
  createdAt: Date;
  updatedAt: Date;
}
```

**Use Cases**: Thought generation, plan creation

### Plan

Executable plan created by the Planner Agent.

```typescript
interface IPlan {
  thoughtId?: string;      // Reference to Thought
  userQuery: string;
  goal: string;
  steps: Array<{
    id: string;
    order: number;
    action: string;        // Tool name to execute
    parameters: Record<string, any>;
    expectedOutput?: Record<string, any>;
    dependencies: string[]; // Step IDs this depends on
    status: 'pending' | 'in_progress' | 'completed' | 'failed' | 'skipped';
  }>;
  missingData: Array<{
    step: string;
    field: string;
    type: string;
    description?: string;
  }>;
  status: 'pending' | 'in_progress' | 'completed' | 'failed' | 'cancelled';
  agentConfigId: string;
  createdAt: Date;
  updatedAt: Date;
}
```

**Use Cases**: Plan creation, task execution

### Task

Execution tracking for a plan.

```typescript
interface ITask {
  planId: string;
  status: 'pending' | 'in_progress' | 'paused' | 'completed' | 'failed' | 'cancelled';
  stepOutputs: Map<string, any>;        // stepId -> output
  userInputs: Map<string, any>;          // stepId -> user input
  pendingUserInputs: Array<{
    stepId: string;
    field: string;
    description?: string;
  }>;
  retryCount: Map<string, number>;       // stepId -> retry count
  currentStepIndex: number;
  executionHistory: Array<{
    stepId: string;
    timestamp: Date;
    status: 'started' | 'completed' | 'failed' | 'skipped';
    error?: string;
    duration?: number;  // milliseconds
    output?: any;
  }>;
  error?: string;
  agentConfigId: string;
  timeout?: number;      // milliseconds, default 30000
  lockToken?: string;    // For optimistic locking
  maxRetries?: number;  // default 3
  createdAt: Date;
  updatedAt: Date;
}
```

**Use Cases**: Task execution, progress tracking

### Request

User query tracking for analytics.

```typescript
interface IRequest {
  query: string;
  categories: string[];
  version: string;
  tags: string[];
  createdAt: Date;
  updatedAt: Date;
}
```

**Use Cases**: Analytics, query tracking

## Intelligence Models

### MemoryPattern

Learned patterns from successful executions.

```typescript
interface IMemoryPattern {
  patternId: string;
  patternType: 'query_pattern' | 'plan_pattern' | 'tool_sequence' | 'error_pattern';
  pattern: {
    query?: string;
    goal?: string;
    steps?: string[];
    context?: string;
  };
  successMetrics: {
    successRate: number;        // 0-1
    avgExecutionTime: number;
    avgSteps: number;
    reliability: number;        // 0-1
  };
  usageCount: number;
  lastUsed: Date;
  firstSeen: Date;
  evidence: Array<{
    taskId: string;
    planId: string;
    outcome: 'success' | 'failure';
    timestamp: Date;
  }>;
  confidence: number;  // 0-1
  validatedAt: Date;
}
```

**Use Cases**: Pattern recognition, plan generation

### ToolPerformance

Tool performance metrics.

```typescript
interface IToolPerformance {
  toolName: string;
  totalExecutions: number;
  successCount: number;
  failureCount: number;
  avgDuration: number;
  commonErrors: Array<{
    error: string;
    frequency: number;
    context: string;
  }>;
  optimalContext: string[];
  lastUpdated: Date;
}
```

**Use Cases**: Tool recommendations, performance analysis

### UserPreference

User-specific preferences and learnings.

```typescript
interface IUserPreference {
  userId?: string;
  preferenceType: 'tool_preference' | 'parameter_default' | 'workflow';
  key: string;
  value: any;
  context?: string;
  confidence: number;  // 0-1
  usageCount: number;
  lastUsed: Date;
  createdAt: Date;
}
```

**Use Cases**: Personalization, parameter defaults

### AgentInsight

Learned insights for agents.

```typescript
interface IAgentInsight {
  agentType: 'thought' | 'planner' | 'executor';
  insightType: 'patterns' | 'optimizations' | 'warnings';
  insight: string;
  rule?: string;  // Machine-readable rule
  appliesTo: {
    agents?: string[];
    contexts?: string[];
    conditions?: Record<string, any>;
  };
  evidence: Array<{
    taskId: string;
    description: string;
  }>;
  confidence: number;  // 0-1
  createdAt: Date;
}
```

**Use Cases**: Agent optimization, warnings

### PlanQualityPrediction

Prediction of plan success before execution.

```typescript
interface IPlanQualityPrediction {
  planId: string;
  successProbability: number;  // 0-1
  riskFactors: string[];
  recommendations: string[];
  confidence: number;  // 0-1
  createdAt: Date;
}
```

**Use Cases**: Plan quality assessment

### ToolRecommendation

Tool recommendations for specific actions.

```typescript
interface IToolRecommendation {
  requiredAction: string;
  context?: string;
  recommendations: Array<{
    toolName: string;
    confidence: number;  // 0-1
    reason: string;
    performanceData?: {
      successRate: number;
      avgDuration: number;
    };
  }>;
  createdAt: Date;
}
```

**Use Cases**: Tool selection optimization

### CostTracking

Token usage and cost tracking.

```typescript
interface ICostTracking {
  taskId: string;
  planId: string;
  agentConfigId: string;
  tokenUsage: {
    promptTokens: number;
    completionTokens: number;
    totalTokens: number;
  };
  cost: {
    amount: number;
    currency: string;
    model: string;
  };
  apiCalls: number;
  createdAt: Date;
}
```

**Use Cases**: Cost monitoring, optimization

## Benchmark Models

### BenchmarkTest

Test definition for benchmarking.

```typescript
interface IBenchmarkTest {
  name: string;
  description: string;
  query: string;
  expectedOutcome: {
    type: 'success' | 'failure' | 'specific_output';
    expectedOutput?: any;
    expectedSteps?: string[];
    maxDuration?: number;  // milliseconds
  };
  category: string;  // e.g., 'crud', 'complex', 'error_handling'
  tags: string[];
  priority: 'critical' | 'high' | 'medium' | 'low';
  createdAt: Date;
  updatedAt: Date;
}
```

**Use Cases**: Test definition, benchmarking

### BenchmarkRun

Execution result for a benchmark test.

```typescript
interface IBenchmarkRun {
  testId: string;
  agentConfigId: string;
  status: 'success' | 'failure' | 'timeout' | 'error';
  metrics: {
    executionTime: number;  // milliseconds
    stepsCompleted: number;
    retries: number;
    userInputsRequired: number;
  };
  tokenUsage?: {
    promptTokens: number;
    completionTokens: number;
    totalTokens: number;
  };
  actualOutput?: any;
  error?: string;
  createdAt: Date;
}
```

**Use Cases**: Performance tracking, regression detection

### BenchmarkSuite

Collection of benchmark tests.

```typescript
interface IBenchmarkSuite {
  name: string;
  description: string;
  testIds: string[];
  createdAt: Date;
  updatedAt: Date;
}
```

**Use Cases**: Test suite management

### PerformanceMetrics

Time series performance metrics.

```typescript
interface IPerformanceMetrics {
  metricType: 'success_rate' | 'avg_duration' | 'token_usage' | 'error_rate';
  period: 'hour' | 'day' | 'week' | 'month';
  value: number;
  timestamp: Date;
  metadata?: Record<string, any>;
}
```

**Use Cases**: Performance monitoring, trend analysis

### Regression

Detected performance regression.

```typescript
interface IRegression {
  testId: string;
  metric: string;
  baselineValue: number;
  currentValue: number;
  delta: number;  // percentage change
  severity: 'low' | 'medium' | 'high' | 'critical';
  detectedAt: Date;
}
```

**Use Cases**: Quality assurance, performance monitoring

## Relationships

### Core Flow
```
Request → Thought → Plan → Task → Results
```

### Intelligence Flow
```
Task Execution → Memory System → Patterns/Insights → Future Decisions
```

### Benchmark Flow
```
BenchmarkTest → BenchmarkRun → PerformanceMetrics → Regression Detection
```

## Indexes

All models include indexes for:
- `createdAt` (descending) - For sorting by date
- Status fields - For filtering
- Foreign keys - For joins
- Text fields - For search (where applicable)

## Next Steps

- Learn about [Request Flow](./request-flow.md)
- Understand [MCP Integration](./mcp-integration.md)
- Explore [Features](../features/overview.md)

